<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>è´­é”€å•ç³»ç»Ÿ - å¢å¼ºç‰ˆ</title>
    <style>
        /* è‡ªåŠ¨åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .sync-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            opacity: 0.7;
        }
        
        .sync-status:hover {
            opacity: 1;
        }
        
        .sync-status.syncing {
            background: #17a2b8;
        }
        
        .sync-status.success {
            background: #28a745;
        }
        
        .sync-status.error {
            background: #dc3545;
        }
        
        .sync-status.offline {
            background: #6c757d;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .sync-status.syncing .sync-indicator {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* è®¾å¤‡ç®¡ç†é¢æ¿æ ·å¼ */
        .device-panel {
            position: fixed;
            top: 0;
            left: -350px;
            width: 350px;
            height: 100vh;
            background: white;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 9999;
            overflow-y: auto;
        }
        
        .device-panel.show {
            left: 0;
        }
        
        .device-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .device-content {
            padding: 20px;
        }
        
        .device-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        
        .device-item.current {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .device-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .device-info {
            font-size: 12px;
            color: #6c757d;
        }
        
        .sync-code-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .sync-code {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
            letter-spacing: 2px;
        }
        
        .qr-code {
            margin: 15px 0;
        }
        
        .qr-code canvas {
            border: 2px solid #dee2e6;
            border-radius: 8px;
        }

        /* ç”¨æˆ·ä¿¡æ¯æ æ ·å¼ */
        .user-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            margin: -10px -10px 15px -10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-role {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .user-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .user-btn:hover {
            background: rgba(255,255,255,0.3);
            color: white;
        }
        
        .login-prompt {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            margin: -10px -10px 15px -10px;
            text-align: center;
            border-bottom: 1px solid #ffeaa7;
        }
        
        .login-prompt a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            margin: 0 5px;
        }
        
        .login-prompt a:hover {
            text-decoration: underline;
        }
        
        @media screen and (max-width: 768px) {
            .user-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .user-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .user-btn {
                font-size: 11px;
                padding: 5px 10px;
            }
            
            .sync-status {
                position: relative;
                top: auto;
                left: auto;
                margin: 10px auto;
                display: inline-flex;
            }
            
            .device-panel {
                width: 100%;
                left: -100%;
            }
        }
        
        body {
            font-family: "SimSun", "å®‹ä½“", serif;
            margin: 10px;
            line-height: 1.3;
            color: #000;
            font-size: 12px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }
        
        /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ– */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        input, textarea, select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0;
        }
        
        /* é˜²æ­¢ç§»åŠ¨ç«¯ç¼©æ”¾ */
        input[type="text"], input[type="number"], input[type="date"] {
            font-size: 12px;
        }
        
        @media screen and (max-width: 768px) {
            input[type="text"], input[type="number"], input[type="date"] {
                font-size: 11px;
            }
        }
        
        .header {
            text-align: center;
            margin-bottom: 12px;
            background: #f8f9fa;
            color: #000000;
            padding: 10px;
            border: 1px solid #000000;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .header h1 {
            font-family: "Microsoft YaHei", "é»‘ä½“", "SimHei", sans-serif;
            font-size: 28px;
            font-weight: 900;
            margin: 0;
            color: #000000;
            text-shadow: none;
            letter-spacing: 2px;
        }
        
        .document-type-wrapper {
            position: relative;
            display: inline-block;
            margin-left: 5px;
        }
        
        .document-type-display {
            cursor: pointer;
            font-size: 20px;
            font-weight: 700;
            font-family: "Microsoft YaHei", "é»‘ä½“", "SimHei", sans-serif;
            color: #000000;
            user-select: none;
            letter-spacing: 1px;
        }
        
        .doc-type-text {
            display: inline;
        }
        
        .dropdown-arrow {
            display: none;
            margin-left: 5px;
            font-size: 16px;
        }
        
        .document-type-display:hover .dropdown-arrow {
            display: inline;
        }
        
        .document-type-display:hover {
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
            padding: 2px 4px;
        }
        
        /* æ‰“å°æ—¶éšè—åŒæ­¥ç›¸å…³å…ƒç´ å’Œä¼˜åŒ–æ‰“å°æ ·å¼ */
        @media print {
            .dropdown-arrow,
            .document-type-dropdown,
            .sync-status,
            .device-panel,
            .action-buttons,
            .user-bar,
            .login-prompt,
            .file-list-panel {
                display: none !important;
            }
            
            /* æ‰“å°ä¼˜åŒ– */
            body {
                margin: 0 !important;
                padding: 0 !important;
                font-size: 11px !important;
                line-height: 1.2 !important;
            }
            
            .header {
                margin-bottom: 8px !important;
                padding: 8px !important;
            }
            
            .header h1 {
                font-size: 24px !important;
                margin: 0 !important;
            }
            
            .document-type-display {
                font-size: 18px !important;
            }
            
            .notice {
                font-size: 10px !important;
                margin-bottom: 6px !important;
                padding: 6px !important;
            }
            
            table {
                margin-bottom: 6px !important;
                page-break-inside: avoid;
            }
            
            .info-table td {
                height: 22px !important;
                font-size: 10px !important;
                padding: 4px !important;
            }
            
            .product-table th {
                font-size: 11px !important;
                padding: 6px 4px !important;
            }
            
            .product-table td {
                height: 20px !important;
                font-size: 10px !important;
                padding: 3px !important;
            }
            
            .payment-table td {
                height: 20px !important;
                font-size: 10px !important;
                padding: 4px !important;
            }
            
            .terms {
                font-size: 10px !important;
                margin-top: 6px !important;
                padding: 6px !important;
            }
            
            .signature-section {
                margin-top: 6px !important;
            }
            
            .signature-box {
                font-size: 10px !important;
                padding: 6px !important;
            }
            
            .agreement {
                font-size: 9px !important;
                margin-top: 6px !important;
                padding: 6px !important;
            }
            
            /* å»é™¤é¡µçœ‰é¡µè„š */
            @page {
                margin: 0.3in;
                size: A4;
            }
            
            /* ä¿®å¤æ ‡é¢˜æ˜¾ç¤ºé—®é¢˜ */
            .header h1 {
                white-space: nowrap !important;
                overflow: visible !important;
            }
            
            .document-type-wrapper {
                display: inline !important;
            }
        }
        
        .document-type-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 120px;
            display: none;
        }
        
        .document-type-dropdown.show {
            display: block;
        }
        
        .dropdown-option {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            font-family: "Microsoft YaHei", "é»‘ä½“", "SimHei", sans-serif;
            color: #333;
        }
        
        .dropdown-option:hover {
            background: #f5f5f5;
        }
        
        .dropdown-option:first-child {
            border-radius: 4px 4px 0 0;
        }
        
        .dropdown-option:last-child {
            border-radius: 0 0 4px 4px;
        }
        
        .header .order-number {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            background: rgba(0,0,0,0.1);
            padding: 8px 15px;
            border-radius: 5px;
            backdrop-filter: blur(10px);
        }
        
        .order-number input {
            background: transparent;
            border: none;
            color: #000000;
            font-size: 16px;
            width: 160px;
            outline: none;
            border-bottom: 2px solid rgba(0,0,0,0.5);
            padding: 5px;
        }
        
        .order-number input::placeholder {
            color: rgba(0,0,0,0.7);
        }
        
        .notice {
            font-size: 12px;
            margin-bottom: 10px;
            padding: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            border-radius: 4px;
            border-left: 3px solid #6c757d;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .notice strong {
            font-size: 16px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 8px;
            border: 2px solid #000000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        td, th {
            border: 1px solid #000000;
            padding: 6px;
            text-align: left;
            vertical-align: middle;
        }
        
        .info-table td {
            height: 28px;
            font-size: 12px;
        }
        
        .info-table td:first-child {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: center;
        }
        
        .product-table th {
            background: #f8f9fa;
            color: #000000;
            text-align: center;
            font-family: "Microsoft YaHei", "é»‘ä½“", "SimHei", sans-serif;
            font-weight: 900;
            font-size: 14px;
            padding: 12px 8px;
            border: 1px solid #000000;
            letter-spacing: 1px;
        }
        
        .product-table td {
            height: 24px;
            font-size: 12px;
        }
        
        .product-table tfoot td {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .payment-section {
            margin-top: 8px;
        }
        
        .payment-table td {
            height: 26px;
            font-size: 12px;
        }
        
        .payment-table td:first-child {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: center;
        }
        
        .terms {
            margin-top: 10px;
            font-size: 12px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #6c757d;
        }
        
        .terms strong {
            font-size: 13px;
            color: #333;
        }
        
        .signature-section {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .signature-box {
            flex: 1;
            text-align: center;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .signature-line {
            height: 30px;
            border-bottom: 2px solid #333;
            margin: 8px 0;
        }
        
        .signature-stamp {
            height: 30px;
            border: 2px solid #333;
            margin: 8px 0;
            border-radius: 3px;
        }
        
        .agreement {
            font-size: 11px;
            margin-top: 8px;
            padding: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 4px;
            border-left: 3px solid #6c757d;
        }
        
        .agreement strong {
            font-size: 12px;
            color: #495057;
        }
        
        .input-field {
            width: 100%;
            border: none;
            outline: none;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            padding: 2px;
        }
        
        .model-input {
            background: #f8f9fa;
            border-radius: 3px;
        }
        
        .delivery-container {
            height: 100%;
            display: flex;
        }
        
        .delivery-label {
            width: 40%;
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #333;
        }
        
        .delivery-input {
            width: 60%;
            padding: 12px;
            display: flex;
            align-items: center;
        }
        
        .action-buttons {
            margin: 20px 0;
            text-align: center;
            gap: 15px;
            display: flex;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-print {
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(73, 80, 87, 0.4);
        }
        
        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(73, 80, 87, 0.6);
        }
        
        .btn-export {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }
        
        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.6);
        }
        
        .btn-image {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }
        
        .btn-image:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
        }
        
        .btn-save-new {
            background: linear-gradient(135deg, #fd7e14 0%, #e63946 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(253, 126, 20, 0.4);
        }
        
        .btn-save-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(253, 126, 20, 0.6);
        }
        
        .btn-sync {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-sync:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .amount-container {
            display: flex;
            height: 100%;
        }
        
        .amount-chinese {
            width: 65%;
            padding: 8px 12px;
            border-right: 1px solid #333;
            display: flex;
            align-items: center;
        }
        
        .amount-number {
            width: 35%;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* æ–‡ä»¶åˆ—è¡¨é¢æ¿æ ·å¼ */
        .file-list-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .file-list-panel.show {
            right: 0;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .panel-content {
            padding: 20px;
        }

        .file-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }

        .file-list-content {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .file-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 15px;
            background: white;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .file-header {
            margin-bottom: 8px;
        }
        
        .file-creator {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 4px;
        }
        
        .file-title {
            font-size: 15px;
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .file-meta {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .file-preview {
            font-size: 13px;
            color: #495057;
            margin-bottom: 10px;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-actions .btn {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        .empty-message {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
            font-style: italic;
        }
        
        .search-container {
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-btn {
            padding: 10px 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s ease;
        }
        
        .search-btn:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .file-list-panel {
                width: 100%;
                right: -100%;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
                margin: 15px 0;
                padding: 0 5px;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 16px;
                width: 100%;
                margin: 0;
                border-radius: 8px;
                touch-action: manipulation;
                -webkit-appearance: none;
                cursor: pointer;
            }
        }
    </style>
</head>
<body>
    <!-- åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="syncStatus" class="sync-status">
        <div class="sync-indicator"></div>
        <span id="syncStatusText">å·²è¿æ¥</span>
    </div>

    <!-- è®¾å¤‡ç®¡ç†é¢æ¿ -->
    <div id="devicePanel" class="device-panel">
        <div class="device-header">
            <h3>ğŸ”„ è®¾å¤‡åŒæ­¥</h3>
            <button class="close-btn" onclick="toggleDevicePanel()">âœ•</button>
        </div>
        <div class="device-content">
            <div class="sync-code-section">
                <h4>ğŸ“± åŒæ­¥ç </h4>
                <div class="sync-code" id="syncCode">------</div>
                <div class="qr-code" id="qrCode"></div>
                <p style="font-size: 12px; color: #6c757d; margin: 10px 0;">
                    åœ¨å…¶ä»–è®¾å¤‡ä¸Šè¾“å…¥æ­¤6ä½æ•°å­—ç å³å¯åŒæ­¥æ•°æ®
                </p>
                <button class="btn btn-sync" onclick="generateNewSyncCode()" style="margin: 10px 5px; padding: 8px 15px; font-size: 12px;">ğŸ”„ ç”Ÿæˆæ–°ç </button>
                <button class="btn btn-sync" onclick="inputSyncCode()" style="margin: 10px 5px; padding: 8px 15px; font-size: 12px;">ğŸ“¥ è¾“å…¥åŒæ­¥ç </button>
            </div>
            
            <div class="device-list">
                <h4>ğŸ“± å·²è¿æ¥è®¾å¤‡</h4>
                <div id="deviceList">
                    <div class="device-item current">
                        <div class="device-name">å½“å‰è®¾å¤‡</div>
                        <div class="device-info">æœ€ååŒæ­¥: åˆšåˆš</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
    <div id="userBar" class="user-bar" style="display: none;">
        <div class="user-info">
            <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
            <div class="user-details">
                <div class="user-name" id="userName">ç”¨æˆ·å</div>
                <div class="user-role" id="userRole">è§’è‰²</div>
            </div>
        </div>
        <div class="user-actions">
            <a href="user-management.html" class="user-btn" id="userManagementBtn" style="display: none;">
                ğŸ‘¥ ç”¨æˆ·ç®¡ç†
            </a>
            <button class="user-btn" onclick="showUserProfile()">
                âš™ï¸ ä¸ªäººè®¾ç½®
            </button>
            <button class="user-btn" onclick="logout()">
                ğŸšª é€€å‡ºç™»å½•
            </button>
        </div>
    </div>
    
    <!-- ç™»å½•æç¤ºæ  -->
    <div id="loginPrompt" class="login-prompt">
        ğŸ” æ‚¨å½“å‰ä½¿ç”¨çš„æ˜¯è®¿å®¢æ¨¡å¼ï¼Œ
        <a href="./login.html">ç«‹å³ç™»å½•</a> æˆ– 
        <a href="./register.html">æ³¨å†Œè´¦å·</a> 
        äº«å—å®Œæ•´åŠŸèƒ½
    </div>
    
    <div class="action-buttons">
        <button class="btn btn-sync" onclick="toggleDevicePanel()">ğŸ”„ è®¾å¤‡åŒæ­¥</button>
        <button class="btn btn-save" onclick="saveToCloud()">â˜ï¸ ä¿å­˜åˆ°äº‘ç«¯</button>
        <button class="btn btn-save-new" onclick="saveAndNew()">ğŸ’¾ ä¿å­˜å¹¶æ–°å»º</button>
        <button class="btn btn-files" onclick="toggleFileList()">ğŸ“ æ–‡ä»¶åˆ—è¡¨</button>
        <button class="btn btn-manage" onclick="openDataManager()">ğŸ“Š æ•°æ®ç®¡ç†</button>
        <button class="btn btn-print" onclick="printForm()">ğŸ–¨ï¸ æ‰“å°è¡¨å•</button>
        <button class="btn btn-export" onclick="exportToPDF()">ğŸ“„ å¯¼å‡ºPDF</button>
        <button class="btn btn-image" onclick="exportToImage()">ğŸ–¼ï¸ å¯¼å‡ºå›¾ç‰‡</button>
    </div>

    <div class="header">
        <h1>å®š/é”€è´§å•(<span class="document-type-wrapper">
            <span class="document-type-display" onclick="toggleDocTypeDropdown()">
                <span class="doc-type-text">é¢„ç®—</span><span class="dropdown-arrow">â–¼</span>
            </span>
            <div class="document-type-dropdown" id="docTypeDropdown">
                <div class="dropdown-option" onclick="selectDocType('é¢„ç®—')">é¢„ç®—</div>
                <div class="dropdown-option" onclick="selectDocType('ç»“ç®—')">ç»“ç®—</div>
            </div>
        </span>)</h1>
        <div class="order-number">
            å•å·ï¼š<input type="text" placeholder="è¯·è¾“å…¥å•å·" id="orderNumberInput">
        </div>
    </div>
    
    <div class="notice">
        <strong>æ¸©é¦¨æç¤ºï¼š</strong>ä¸ºäº†è´­è´§æ–¹çš„åˆæ³•æƒç›Šç‰¹åˆ¶è®¢æ­¤æ”¿ç­–ï¼Œè¯·è¯¦ç»†é˜…è¯»æœ¬å•æ®è´­ç‰©é¡»çŸ¥ï¼Œå¹¶ç¡®è®¤å•æ®å†…å„é¡¹è´­ç‰©å†…å®¹ã€‚ä¸€ç»ç­¾å­—ç¡®è®¤ï¼Œå°†è§†åŒè´­è´§æ–¹å¯¹æœ¬å•æ®æ‰€æœ‰å†…å®¹å‡è¡¨ç¤ºåŒæ„ã€‚
    </div>
    
    <table class="info-table">
        <tr>
            <td style="width: 15%;">è´­è´§æ–¹</td>
            <td style="width: 35%;"><input type="text" class="input-field"></td>
            <td style="width: 15%;">è´­è´§æ–¹è”ç³»äºº/ç”µè¯</td>
            <td style="width: 35%;"><input type="text" class="input-field"></td>
        </tr>
        <tr>
            <td>ä¾›è´§æ–¹</td>
            <td><input type="text" class="input-field" value="å¦é—¨æ±‡ä»•ç¯ä¿ç§‘æŠ€æœ‰é™å…¬å¸"></td>
            <td>ä¾›è´§æ–¹ç”µè¯</td>
            <td><input type="text" class="input-field" value="0592-5772750"></td>
        </tr>
        <tr>
            <td>ä¾›è´§æ–¹åœ°å€</td>
            <td colspan="2"><input type="text" class="input-field" value="å¦é—¨å¸‚æ¹–é‡ŒåŒºé’Ÿå®…çº¢æ˜Ÿç¾å‡¯é¾™E8038"></td>
            <td rowspan="2" style="padding: 0;">
                <div class="delivery-container">
                    <div class="delivery-label">é€è´§æ–¹å¼</div>
                    <div class="delivery-input">
                        <input type="text" class="input-field" list="deliveryList">
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td>æ”¶è´§æ–¹åœ°å€</td>
            <td colspan="2"><input type="text" class="input-field"></td>
        </tr>
        <tr>
            <td>è®¢è´§æ—¥æœŸ</td>
            <td><input type="date" class="input-field"></td>
            <td>é€è´§æ—¶é—´</td>
            <td><input type="date" class="input-field"></td>
        </tr>
    </table>
    
    <table class="product-table">
        <thead>
            <tr>
                <th style="width: 22%;">å•†å“åç§°(å“ç‰Œ+åç§°)</th>
                <th style="width: 10%;">å‹å·</th>
                <th style="width: 10%;">è§„æ ¼</th>
                <th style="width: 10%;">é›¶å”®ä»·</th>
                <th style="width: 8%;">æ•°é‡</th>
                <th style="width: 8%;">å•ä½</th>
                <th style="width: 12%;">åˆä»·</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            <tr><td><input type="text" class="input-field" list="productList"></td><td><input type="text" class="input-field model-input" list="modelList"></td><td><input type="text" class="input-field" list="specsList"></td><td><input type="number" class="input-field" step="0.01"></td><td><input type="number" class="input-field"></td><td><input type="text" class="input-field" placeholder="ã¡"></td><td><input type="number" class="input-field" step="0.01" readonly></td></tr>
            
    <datalist id="productList">
        <option value="TECH Xéš”çƒ­è†œ" data-specs="1.52m*30m" data-price="680">
        <option value="éš”çƒ­è†œå®‰è£…è´¹" data-specs="æŒ‰é¢ç§¯è®¡ç®—" data-price="25">
        <option value="å®¶å±…ä¿æŠ¤è†œ" data-specs="1.52m*30m" data-price="450">
        <option value="ç»ç’ƒè†œï¼ˆé˜²ç´«å¤–é˜²çˆ†ï¼‰" data-specs="1.52m*30m" data-price="800">
        <option value="å®‰å…¨é˜²çˆ†è†œ" data-specs="1.52m*30m" data-price="800">
    </datalist>
    <datalist id="modelList">
        <option value="æ™¨æ›¦" data-specs="é€å…‰ç‡70%" data-price="799">
        <option value="æš®è¯­" data-specs="é€å…‰ç‡50%" data-price="799">
        <option value="æ™ºå¹•Pro70" data-specs="é€å…‰ç‡70%" data-price="1380">
        <option value="æ™ºå¹•Pro30" data-specs="é€å…‰ç‡30%" data-price="1380">
        <option value="ç»´å¡”VITA" data-specs="é€å…‰ç‡80%" data-price="299" data-unit="å»¶ç±³">
        <option value="å‡Œç´«" data-specs="é€å…‰ç‡60%" data-price="299">
    </datalist>
    <datalist id="specsList">
        <option value="1.52m*30m">
        <option value="1.52m*15m">
        <option value="æŒ‰é¢ç§¯è®¡ç®—">
        <option value="é€å…‰ç‡70%">
        <option value="é€å…‰ç‡50%">
        <option value="é€å…‰ç‡30%">
        <option value="é€å…‰ç‡80%">
        <option value="é€å…‰ç‡60%">
        <option value="å…¨è½¦è´´è†œ">
    </datalist>
    <datalist id="paymentList">
        <option value="å¯¹ç§è½¬è´¦">
        <option value="å¯¹å…¬è½¬è´¦">
        <option value="å¾®ä¿¡è½¬è´¦">
        <option value="ç°é‡‘äº¤ä»˜">
    </datalist>
    <datalist id="deliveryList">
        <option value="é€è´§ä¸Šé—¨">
        <option value="è‡ªæ">
    </datalist>
        </tbody>
        <tfoot>
            <tr style="background-color: #f8f9fa; font-weight: bold;">
                <td colspan="6" style="text-align: right; padding-right: 10px;">åˆè®¡ï¼š</td>
                <td><input type="number" id="totalAmount" class="input-field" step="0.01" readonly style="font-weight: bold; background-color: #f8f9fa;"></td>
            </tr>
        </tfoot>
    </table>
    
    <table>
        <tr>
            <td style="width: 15%; text-align: center; font-weight: bold; background-color: #f8f9fa;">å¤‡æ³¨</td>
            <td style="height: 50px;"><input type="text" class="input-field" value="è´¨ä¿æœŸäº”å¹´ï¼Œä»å®‰è£…ç»“æŸä¹‹æ—¥èµ·ç®—ï¼›è´¨ä¿æœŸå†…éäººä¸ºå’Œè‡ªç„¶ç¾å®³åŸå› å¼•èµ·çš„è´¨é‡é—®é¢˜ã€å®‰è£…é—®é¢˜ï¼Œç”±ä¾›è´§æ–¹è´Ÿè´£ç»´ä¿"></td>
        </tr>
    </table>
    
    <div class="payment-section">
        <table class="payment-table">
            <tr>
                <td style="width: 15%;">ä»˜æ¬¾æ–¹å¼</td>
                <td style="width: 85%;"><input type="text" class="input-field" list="paymentList"></td>
            </tr>
            <tr>
                <td>æ”¶æ¬¾è´¦æˆ·</td>
                <td style="white-space: nowrap;">è´¦å·ï¼š<input type="text" class="input-field" style="width: 20%; display: inline-block;" value="6226 1529 0065 3167"> æˆ·åï¼š<input type="text" class="input-field" style="width: 15%; display: inline-block;" value="é¥¶ç‰ç"> å¼€æˆ·è¡Œï¼š<input type="text" class="input-field" style="width: 50%; display: inline-block;" value="ä¸­å›½æ°‘ç”Ÿé“¶è¡Œ"></td>
            </tr>
            <tr>
                <td>å®å”®é‡‘é¢</td>
                <td style="padding: 0;">
                    <div class="amount-container">
                        <div class="amount-chinese">
                            <input type="text" class="input-field chinese-amount" placeholder="å¤§å†™é‡‘é¢" readonly>
                        </div>
                        <div class="amount-number">
                            å°å†™(Â¥) <input type="number" class="input-field amount-input" style="width: 60%;" step="0.01">
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td id="paymentLabel">æœ¬æ¬¡ä»˜æ¬¾é‡‘é¢</td>
                <td style="padding: 0;">
                    <div class="amount-container">
                        <div class="amount-chinese">
                            <input type="text" class="input-field chinese-payment" placeholder="å¤§å†™é‡‘é¢" readonly>
                        </div>
                        <div class="amount-number">
                            å°å†™(Â¥) <input type="number" class="input-field payment-input" style="width: 60%;" step="0.01">
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>è´§æ¬¾ä½™é¢</td>
                <td style="padding: 0;">
                    <div class="amount-container">
                        <div class="amount-chinese">
                            <input type="text" class="input-field chinese-balance" placeholder="å¤§å†™é‡‘é¢" readonly>
                        </div>
                        <div class="amount-number">
                            å°å†™(Â¥) <input type="number" class="input-field balance-input" style="width: 60%;" step="0.01" readonly>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    
    <div class="terms">
        <strong>å…¶ä»–çº¦å®šï¼š</strong><br>
        1. è´§æ¬¾ä½™é¢åº”ç”±è´­è´§æ–¹åœ¨<input type="text" class="input-field" style="width: 200px; border-bottom: 1px solid #000; display: inline-block;">ä»˜æ¸…ã€‚<br>
        2. æœ¬å•å®å”®åˆè®¡é‡‘é¢ä¸­å·²åŒ…å«ä¸Šé—¨æ£€æµ‹ã€æµ‹é‡ã€è®¾è®¡ã€å‡ºå›¾ç­‰ç›¸å…³è´¹ç”¨ã€‚
    </div>
    
    <div class="signature-section">
        <div class="signature-box">
            <div>ä¾›è´§æ–¹ç­¾å­—ï¼š</div>
            <div class="signature-line"></div>
        </div>
        <div class="signature-box">
            <div>å”®åæœåŠ¡ç« ï¼š</div>
            <div class="signature-stamp"></div>
        </div>
        <div class="signature-box">
            <div>è´­è´§æ–¹ç­¾å­—ï¼š</div>
            <div class="signature-line"></div>
        </div>
    </div>
    
    <div class="agreement">
        <strong>è´­é”€çº¦å®šï¼š</strong>1. å¦‚æœå·²ä»˜é‡‘é¢å°äºåˆè®¡é‡‘é¢çš„30%ï¼Œåˆ™ä»¥å·²ä»˜é‡‘é¢åšä¸ºäº¤æ˜“å®šé‡‘ï¼›å¦‚æœå·²ä»˜é‡‘é¢å¤§äºç­‰äºåˆè®¡é‡‘é¢çš„30%ï¼Œåˆ™ä»¥åˆè®¡é‡‘é¢çš„30%åšä¸ºå®šé‡‘ã€‚2. è´­è´§æ–¹è¿çº¦é€€è´§çš„ï¼Œæ— æƒè¦æ±‚è¿”å›å®šé‡‘ï¼›ä¾›è´§æ–¹ä¸èƒ½äº¤è´§çš„ï¼Œåˆ™åº”è¿”è¿˜å®šé‡‘ã€‚
    </div>

    <!-- æ–‡ä»¶åˆ—è¡¨é¢æ¿ -->
    <div id="fileListPanel" class="file-list-panel">
        <div class="panel-header">
            <h3>ğŸ“ æˆ‘çš„æ–‡ä»¶åˆ—è¡¨</h3>
            <button class="close-btn" onclick="toggleFileList()">âœ•</button>
        </div>
        <div class="panel-content">
            <div class="file-stats">
                <span>æ€»è®°å½•æ•°: <strong id="fileCount">0</strong></span>
                <span>æœ€åä¿å­˜: <strong id="lastSave">ä»æœª</strong></span>
            </div>
            
            <!-- æœç´¢åŠŸèƒ½ -->
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢åˆ›å»ºè€…æˆ–ä¹°æ–¹..." onkeyup="window.fileManager.searchFiles()">
                <button class="search-btn" onclick="window.fileManager.clearSearch()">æ¸…é™¤</button>
                <button class="search-btn cleanup-btn" onclick="window.fileManager.cleanupDuplicates()">ğŸ§¹ æ¸…ç†é‡å¤</button>
            </div>
            
            <div id="fileListContent" class="file-list-content">
                <div class="empty-message">æš‚æ— æ–‡ä»¶</div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <!-- åŠŸèƒ½ä¿®å¤è¡¥ä¸ - ä¿æŒåŸæœ‰UIä¸å˜ï¼Œåªä¿®å¤åŠŸèƒ½é—®é¢˜ -->
    <script src="function-fix.js"></script>
    <script>
        // è‡ªåŠ¨åŒæ­¥ç³»ç»Ÿ - JavaScriptä»£ç 
        class AutoSyncSystem {
            constructor() {
                this.deviceId = this.getOrCreateDeviceId();
                this.syncCode = null;
                this.isOnline = navigator.onLine;
                this.syncInterval = null;
                this.lastSyncTime = null;
                this.apiToken = localStorage.getItem('github_api_token');
                this.gistId = localStorage.getItem('sync_gist_id');
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.startAutoSync();
                this.generateSyncCode();
                this.loadUserInfo();
                this.initFileManager();
                
                // å»¶è¿Ÿæ›´æ–°çŠ¶æ€ï¼Œé¿å…ä¸€ç›´æ˜¾ç¤ºåˆå§‹åŒ–
                setTimeout(() => {
                    if (this.isOnline) {
                        this.updateSyncStatus('å·²è¿æ¥', 'success');
                    } else {
                        this.updateSyncStatus('ç¦»çº¿æ¨¡å¼', 'offline');
                    }
                }, 1000);
                
                // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateSyncStatus('å·²è¿æ¥ç½‘ç»œ');
                    this.startAutoSync();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateSyncStatus('ç¦»çº¿æ¨¡å¼', 'offline');
                    this.stopAutoSync();
                });
            }

            getOrCreateDeviceId() {
                let deviceId = localStorage.getItem('device_id');
                if (!deviceId) {
                    deviceId = 'device_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('device_id', deviceId);
                }
                return deviceId;
            }

            setupEventListeners() {
                // ç›‘å¬è¡¨å•æ•°æ®å˜åŒ–
                document.addEventListener('input', (e) => {
                    if (e.target.classList.contains('input-field')) {
                        this.scheduleSync();
                    }
                });

                // ç›‘å¬é¡µé¢å¸è½½
                window.addEventListener('beforeunload', () => {
                    this.syncToCloud();
                });

                // å®šæœŸä¿å­˜
                setInterval(() => {
                    this.saveToLocal();
                }, 30000); // æ¯30ç§’ä¿å­˜ä¸€æ¬¡
            }

            scheduleSync() {
                clearTimeout(this.syncTimeout);
                this.syncTimeout = setTimeout(() => {
                    this.syncToCloud();
                }, 2000); // 2ç§’ååŒæ­¥
            }

            async generateSyncCode() {
                try {
                    // ç”Ÿæˆ6ä½æ•°å­—åŒæ­¥ç 
                    this.syncCode = Math.floor(100000 + Math.random() * 900000).toString();
                    document.getElementById('syncCode').textContent = this.syncCode;
                    
                    // ç”ŸæˆäºŒç»´ç 
                    await this.generateQRCode();
                    
                    // ä¿å­˜åŒæ­¥ç åˆ°äº‘ç«¯
                    if (this.isOnline && this.apiToken) {
                        await this.saveSyncCodeToCloud();
                    }
                    
                } catch (error) {
                    console.error('ç”ŸæˆåŒæ­¥ç å¤±è´¥:', error);
                    this.updateSyncStatus('åŒæ­¥ç ç”Ÿæˆå¤±è´¥', 'error');
                }
            }

            async generateQRCode() {
                try {
                    const qrContainer = document.getElementById('qrCode');
                    qrContainer.innerHTML = '';
                    
                    const canvas = document.createElement('canvas');
                    await QRCode.toCanvas(canvas, this.syncCode, {
                        width: 150,
                        height: 150,
                        margin: 2,
                        color: {
                            dark: '#000000',
                            light: '#FFFFFF'
                        }
                    });
                    
                    qrContainer.appendChild(canvas);
                } catch (error) {
                    console.error('ç”ŸæˆäºŒç»´ç å¤±è´¥:', error);
                    document.getElementById('qrCode').innerHTML = '<p style="color: #dc3545;">äºŒç»´ç ç”Ÿæˆå¤±è´¥</p>';
                }
            }

            async saveSyncCodeToCloud() {
                if (!this.apiToken) return;

                try {
                    const syncData = {
                        code: this.syncCode,
                        deviceId: this.deviceId,
                        timestamp: Date.now(),
                        data: this.collectFormData()
                    };

                    // ä½¿ç”¨åŒæ­¥ç ä½œä¸ºæ–‡ä»¶åï¼Œç¡®ä¿æ¯ä¸ªåŒæ­¥ç æœ‰ç‹¬ç«‹çš„å­˜å‚¨
                    await this.saveToGist(`sync_${this.syncCode}`, syncData);
                    
                    // åŒæ—¶ä¿å­˜åˆ°ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œæ–¹ä¾¿æŸ¥æ‰¾
                    const indexData = {
                        [this.syncCode]: {
                            timestamp: Date.now(),
                            deviceId: this.deviceId,
                            gistId: this.gistId
                        }
                    };
                    
                    // å°è¯•è¯»å–ç°æœ‰ç´¢å¼•å¹¶åˆå¹¶
                    try {
                        const existingIndex = await this.loadFromGist('sync_index');
                        Object.assign(existingIndex, indexData);
                        await this.saveToGist('sync_index', existingIndex);
                    } catch {
                        // å¦‚æœç´¢å¼•ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
                        await this.saveToGist('sync_index', indexData);
                    }
                    
                } catch (error) {
                    console.error('ä¿å­˜åŒæ­¥ç åˆ°äº‘ç«¯å¤±è´¥:', error);
                }
            }

            async saveToGist(filename, data) {
                if (!this.apiToken) {
                    throw new Error('æœªè®¾ç½®API Token');
                }

                const gistData = {
                    description: "è´­é”€å•ç³»ç»Ÿæ•°æ®åŒæ­¥",
                    public: false,
                    files: {
                        [filename + '.json']: {
                            content: JSON.stringify(data, null, 2)
                        }
                    }
                };

                let url = 'https://api.github.com/gists';
                let method = 'POST';

                if (this.gistId) {
                    url = `https://api.github.com/gists/${this.gistId}`;
                    method = 'PATCH';
                }

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Authorization': `token ${this.apiToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(gistData)
                });

                if (!response.ok) {
                    throw new Error(`GitHub APIé”™è¯¯: ${response.status}`);
                }

                const result = await response.json();
                
                if (!this.gistId) {
                    this.gistId = result.id;
                    localStorage.setItem('sync_gist_id', this.gistId);
                }

                return result;
            }

            async loadFromGist(filename) {
                if (!this.apiToken || !this.gistId) {
                    throw new Error('æœªè®¾ç½®API Tokenæˆ–Gist ID');
                }

                const response = await fetch(`https://api.github.com/gists/${this.gistId}`, {
                    headers: {
                        'Authorization': `token ${this.apiToken}`,
                    }
                });

                if (!response.ok) {
                    throw new Error(`GitHub APIé”™è¯¯: ${response.status}`);
                }

                const gist = await response.json();
                const file = gist.files[filename + '.json'];
                
                if (!file) {
                    throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                }

                return JSON.parse(file.content);
            }

            collectFormData() {
                const data = {};
                const inputs = document.querySelectorAll('.input-field');
                
                inputs.forEach((input, index) => {
                    data[`field_${index}`] = input.value;
                });

                // æ”¶é›†ç‰¹æ®Šå­—æ®µ
                data.orderNumber = document.getElementById('orderNumberInput')?.value || '';
                data.documentType = document.querySelector('.doc-type-text')?.textContent || 'é¢„ç®—';
                data.paymentLabel = document.getElementById('paymentLabel')?.textContent || 'æœ¬æ¬¡ä»˜æ¬¾é‡‘é¢';
                data.timestamp = Date.now();
                data.deviceId = this.deviceId;

                return data;
            }

            fillFormData(data) {
                if (!data) return;

                const inputs = document.querySelectorAll('.input-field');
                
                inputs.forEach((input, index) => {
                    if (data[`field_${index}`]) {
                        input.value = data[`field_${index}`];
                    }
                });

                // å¡«å……ç‰¹æ®Šå­—æ®µ
                if (data.orderNumber && document.getElementById('orderNumberInput')) {
                    document.getElementById('orderNumberInput').value = data.orderNumber;
                }

                if (data.documentType) {
                    const docTypeText = document.querySelector('.doc-type-text');
                    if (docTypeText) {
                        docTypeText.textContent = data.documentType;
                    }
                }
                
                if (data.paymentLabel) {
                    const paymentLabel = document.getElementById('paymentLabel');
                    if (paymentLabel) {
                        paymentLabel.textContent = data.paymentLabel;
                    }
                }

                // é‡æ–°è®¡ç®—æ€»é‡‘é¢
                this.calculateTotal();
            }

            async syncToCloud() {
                if (!this.isOnline || !this.apiToken) {
                    this.saveToLocal();
                    return;
                }

                try {
                    this.updateSyncStatus('æ­£åœ¨åŒæ­¥...', 'syncing');
                    
                    const formData = this.collectFormData();
                    await this.saveToGist('form_data', formData);
                    
                    this.lastSyncTime = Date.now();
                    localStorage.setItem('last_sync_time', this.lastSyncTime.toString());
                    
                    this.updateSyncStatus('åŒæ­¥æˆåŠŸ', 'success');
                    
                    // 3ç§’åæ¢å¤æ­£å¸¸çŠ¶æ€
                    setTimeout(() => {
                        this.updateSyncStatus('å·²è¿æ¥', 'success');
                    }, 3000);
                    
                } catch (error) {
                    console.error('åŒæ­¥å¤±è´¥:', error);
                    this.updateSyncStatus('åŒæ­¥å¤±è´¥', 'error');
                    this.saveToLocal(); // åŒæ­¥å¤±è´¥æ—¶ä¿å­˜åˆ°æœ¬åœ°
                }
            }

            async loadFromCloud() {
                if (!this.isOnline || !this.apiToken) {
                    this.loadFromLocal();
                    return;
                }

                try {
                    this.updateSyncStatus('æ­£åœ¨åŠ è½½...', 'syncing');
                    
                    const data = await this.loadFromGist('form_data');
                    this.fillFormData(data);
                    
                    this.updateSyncStatus('åŠ è½½æˆåŠŸ', 'success');
                    
                } catch (error) {
                    console.error('åŠ è½½å¤±è´¥:', error);
                    this.updateSyncStatus('åŠ è½½å¤±è´¥', 'error');
                    this.loadFromLocal(); // åŠ è½½å¤±è´¥æ—¶ä»æœ¬åœ°åŠ è½½
                }
            }

            saveToLocal() {
                try {
                    const formData = this.collectFormData();
                    localStorage.setItem('form_data_backup', JSON.stringify(formData));
                    localStorage.setItem('last_local_save', Date.now().toString());
                } catch (error) {
                    console.error('æœ¬åœ°ä¿å­˜å¤±è´¥:', error);
                }
            }

            loadFromLocal() {
                try {
                    const data = localStorage.getItem('form_data_backup');
                    if (data) {
                        this.fillFormData(JSON.parse(data));
                    }
                } catch (error) {
                    console.error('æœ¬åœ°åŠ è½½å¤±è´¥:', error);
                }
            }

            startAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                }

                if (this.isOnline && this.apiToken) {
                    this.syncInterval = setInterval(() => {
                        this.syncToCloud();
                    }, 60000); // æ¯åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
                }
            }

            stopAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
            }

            updateSyncStatus(text, status = 'default') {
                const statusElement = document.getElementById('syncStatus');
                const textElement = document.getElementById('syncStatusText');
                
                if (statusElement && textElement) {
                    textElement.textContent = text;
                    statusElement.className = `sync-status ${status}`;
                }
            }

            async inputSyncCode() {
                const code = prompt('è¯·è¾“å…¥6ä½æ•°å­—åŒæ­¥ç :');
                if (!code || code.length !== 6 || !/^\d{6}$/.test(code)) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„6ä½æ•°å­—åŒæ­¥ç ');
                    return;
                }

                try {
                    this.updateSyncStatus('æ­£åœ¨åŒæ­¥æ•°æ®...', 'syncing');
                    
                    // å¦‚æœæ²¡æœ‰è®¾ç½® API Tokenï¼Œæç¤ºç”¨æˆ·è¾“å…¥
                    if (!this.apiToken) {
                        const token = prompt('è¯·è¾“å…¥GitHub API Tokenï¼ˆç”¨äºåŒæ­¥åŠŸèƒ½ï¼‰:');
                        if (!token) {
                            throw new Error('éœ€è¦GitHub API Tokenæ‰èƒ½ä½¿ç”¨åŒæ­¥åŠŸèƒ½');
                        }
                        this.apiToken = token;
                        localStorage.setItem('github_api_token', token);
                    }
                    
                    // ä»äº‘ç«¯æŸ¥æ‰¾åŒæ­¥ç å¯¹åº”çš„æ•°æ®
                    const syncData = await this.loadSyncDataByCode(code);
                    if (syncData && syncData.data) {
                        this.fillFormData(syncData.data);
                        this.updateSyncStatus('åŒæ­¥æˆåŠŸ', 'success');
                        alert('æ•°æ®åŒæ­¥æˆåŠŸï¼');
                        
                        // ä¿å­˜åŒæ­¥æˆåŠŸçš„è®°å½•
                        localStorage.setItem('last_sync_code', code);
                        localStorage.setItem('last_sync_time', Date.now().toString());
                    } else {
                        throw new Error('æœªæ‰¾åˆ°å¯¹åº”çš„åŒæ­¥æ•°æ®');
                    }
                    
                } catch (error) {
                    console.error('åŒæ­¥å¤±è´¥:', error);
                    this.updateSyncStatus('åŒæ­¥å¤±è´¥', 'error');
                    
                    // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                    let errorMessage = 'åŒæ­¥å¤±è´¥: ' + error.message;
                    if (error.message.includes('GitHub APIé”™è¯¯')) {
                        errorMessage += '

å¯èƒ½çš„åŸå› ï¼š
1. GitHub API Tokenæ— æ•ˆ
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. åŒæ­¥ç å·²è¿‡æœŸ';
                    } else if (error.message.includes('æœªæ‰¾åˆ°')) {
                        errorMessage += '

å¯èƒ½çš„åŸå› ï¼š
1. åŒæ­¥ç è¾“å…¥é”™è¯¯
2. æ•°æ®å°šæœªä¸Šä¼ åˆ°äº‘ç«¯
3. åŒæ­¥ç å·²è¿‡æœŸï¼ˆ24å°æ—¶ï¼‰';
                    }
                    
                    alert(errorMessage);
                }
            }

            async loadSyncDataByCode(code) {
                try {
                    // æ–¹æ³•1ï¼šç›´æ¥å°è¯•è¯»å–å¯¹åº”åŒæ­¥ç çš„æ–‡ä»¶
                    try {
                        const data = await this.loadFromGist(`sync_${code}`);
                        if (data && data.code === code) {
                            return data;
                        }
                    } catch (error) {
                        console.log('ç›´æ¥è¯»å–å¤±è´¥ï¼Œå°è¯•é€šè¿‡ç´¢å¼•æŸ¥æ‰¾:', error.message);
                    }
                    
                    // æ–¹æ³•2ï¼šé€šè¿‡ç´¢å¼•æ–‡ä»¶æŸ¥æ‰¾
                    try {
                        const indexData = await this.loadFromGist('sync_index');
                        if (indexData && indexData[code]) {
                            const syncInfo = indexData[code];
                            
                            // å¦‚æœæœ‰ä¸åŒçš„ gistIdï¼Œå°è¯•ä»é‚£ä¸ª gist è¯»å–
                            if (syncInfo.gistId && syncInfo.gistId !== this.gistId) {
                                const originalGistId = this.gistId;
                                this.gistId = syncInfo.gistId;
                                
                                try {
                                    const data = await this.loadFromGist(`sync_${code}`);
                                    this.gistId = originalGistId; // æ¢å¤åŸæ¥çš„ gistId
                                    
                                    if (data && data.code === code) {
                                        return data;
                                    }
                                } catch (error) {
                                    this.gistId = originalGistId; // ç¡®ä¿æ¢å¤
                                    throw error;
                                }
                            }
                        }
                    } catch (error) {
                        console.log('ç´¢å¼•æŸ¥æ‰¾å¤±è´¥:', error.message);
                    }
                    
                    // æ–¹æ³•3ï¼šæœç´¢æ‰€æœ‰å¯èƒ½çš„å…¬å…± gistï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰
                    throw new Error('æœªæ‰¾åˆ°å¯¹åº”çš„åŒæ­¥æ•°æ®ï¼Œè¯·ç¡®è®¤åŒæ­¥ç æ˜¯å¦æ­£ç¡®');
                    
                } catch (error) {
                    throw new Error('æ— æ³•æ‰¾åˆ°åŒæ­¥æ•°æ®: ' + error.message);
                }
            }

            calculateTotal() {
                const rows = document.querySelectorAll('.product-table tbody tr');
                let total = 0;

                rows.forEach(row => {
                    const priceInput = row.querySelector('td:nth-child(4) input');
                    const quantityInput = row.querySelector('td:nth-child(5) input');
                    const totalInput = row.querySelector('td:nth-child(7) input');

                    if (priceInput && quantityInput && totalInput) {
                        const price = parseFloat(priceInput.value) || 0;
                        const quantity = parseFloat(quantityInput.value) || 0;
                        const rowTotal = price * quantity;
                        
                        totalInput.value = rowTotal.toFixed(2);
                        total += rowTotal;
                    }
                });

                const totalAmountInput = document.getElementById('totalAmount');
                if (totalAmountInput) {
                    totalAmountInput.value = total.toFixed(2);
                }
                
                // è‡ªåŠ¨æ›´æ–°å®å”®é‡‘é¢çš„å¤§å†™å’Œè®¡ç®—è´§æ¬¾ä½™é¢
                this.updateChineseAmount();
                this.calculateBalance();
            }

            // æ•°å­—è½¬ä¸­æ–‡å¤§å†™
            numberToChinese(num) {
                const digits = ['é›¶', 'å£¹', 'è´°', 'å', 'è‚†', 'ä¼', 'é™†', 'æŸ’', 'æŒ', 'ç–'];
                const units = ['', 'æ‹¾', 'ä½°', 'ä»Ÿ'];
                const bigUnits = ['', 'ä¸‡', 'äº¿'];
                
                if (num === 0) return 'é›¶å…ƒæ•´';
                
                let numStr = Math.floor(num * 100).toString(); // è½¬ä¸ºåˆ†
                let result = '';
                
                // å¤„ç†æ•´æ•°éƒ¨åˆ†
                let intPart = Math.floor(num);
                if (intPart === 0) {
                    result = 'é›¶';
                } else {
                    let intStr = intPart.toString();
                    let len = intStr.length;
                    
                    for (let i = 0; i < len; i++) {
                        let digit = parseInt(intStr[i]);
                        let pos = len - i - 1;
                        
                        if (digit !== 0) {
                            result += digits[digit];
                            if (pos > 0) {
                                if (pos < 4) {
                                    result += units[pos];
                                } else if (pos < 8) {
                                    if (pos === 4) result += 'ä¸‡';
                                    else result += units[pos - 4];
                                } else {
                                    if (pos === 8) result += 'äº¿';
                                    else result += units[pos - 8];
                                }
                            }
                        } else if (i < len - 1 && parseInt(intStr[i + 1]) !== 0) {
                            result += 'é›¶';
                        }
                    }
                }
                
                result += 'å…ƒ';
                
                // å¤„ç†å°æ•°éƒ¨åˆ†
                let decimalPart = Math.round((num - intPart) * 100);
                if (decimalPart === 0) {
                    result += 'æ•´';
                } else {
                    let jiao = Math.floor(decimalPart / 10);
                    let fen = decimalPart % 10;
                    
                    if (jiao > 0) {
                        result += digits[jiao] + 'è§’';
                    }
                    if (fen > 0) {
                        result += digits[fen] + 'åˆ†';
                    }
                }
                
                return result;
            }

            // æ›´æ–°å¤§å†™é‡‘é¢
            updateChineseAmount() {
                const totalAmount = parseFloat(document.getElementById('totalAmount')?.value || 0);
                const chineseAmountInput = document.querySelector('.chinese-amount');
                
                if (totalAmount > 0 && chineseAmountInput) {
                    const chineseAmount = this.numberToChinese(totalAmount);
                    chineseAmountInput.value = chineseAmount;
                }
            }

            // è®¡ç®—è´§æ¬¾ä½™é¢
            calculateBalance() {
                const amountInput = document.querySelector('.amount-input');
                const paymentInput = document.querySelector('.payment-input');
                const balanceInput = document.querySelector('.balance-input');
                const chineseBalanceInput = document.querySelector('.chinese-balance');
                
                const amount = parseFloat(amountInput?.value || 0);
                const payment = parseFloat(paymentInput?.value || 0);
                const balance = amount - payment;
                
                if (balanceInput) {
                    balanceInput.value = balance.toFixed(2);
                }
                
                if (chineseBalanceInput && balance > 0) {
                    chineseBalanceInput.value = this.numberToChinese(balance);
                } else if (chineseBalanceInput) {
                    chineseBalanceInput.value = '';
                }
            }

            // è‡ªåŠ¨å¡«å……äº§å“ä¿¡æ¯
            autoFillProductInfo(input, type) {
                const value = input.value;
                const row = input.closest('tr');
                
                if (type === 'product') {
                    // æŸ¥æ‰¾äº§å“ä¿¡æ¯
                    const option = document.querySelector(`#productList option[value="${value}"]`);
                    if (option) {
                        const specs = option.getAttribute('data-specs');
                        const price = option.getAttribute('data-price');
                        const unit = option.getAttribute('data-unit');
                        
                        if (specs) {
                            const specsInput = row.querySelector('td:nth-child(3) input');
                            if (specsInput && !specsInput.value) {
                                specsInput.value = specs;
                            }
                        }
                        
                        if (price) {
                            const priceInput = row.querySelector('td:nth-child(4) input');
                            if (priceInput && !priceInput.value) {
                                priceInput.value = price;
                            }
                        }
                        
                        if (unit) {
                            const unitInput = row.querySelector('td:nth-child(7) input');
                            if (unitInput && !unitInput.value) {
                                unitInput.value = unit;
                            }
                        }
                    }
                } else if (type === 'model') {
                    // æŸ¥æ‰¾å‹å·ä¿¡æ¯
                    const option = document.querySelector(`#modelList option[value="${value}"]`);
                    if (option) {
                        const specs = option.getAttribute('data-specs');
                        const price = option.getAttribute('data-price');
                        const unit = option.getAttribute('data-unit');
                        
                        if (specs) {
                            const specsInput = row.querySelector('td:nth-child(3) input');
                            if (specsInput && !specsInput.value) {
                                specsInput.value = specs;
                            }
                        }
                        
                        if (price) {
                            const priceInput = row.querySelector('td:nth-child(4) input');
                            if (priceInput && !priceInput.value) {
                                priceInput.value = price;
                            }
                        }
                        
                        if (unit) {
                            const unitInput = row.querySelector('td:nth-child(7) input');
                            if (unitInput && !unitInput.value) {
                                unitInput.value = unit;
                            }
                        }
                    }
                }
                
                // é‡æ–°è®¡ç®—æ€»é‡‘é¢
                this.calculateTotal();
            }

            loadUserInfo() {
                try {
                    const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                    const userBar = document.getElementById('userBar');
                    const loginPrompt = document.getElementById('loginPrompt');

                    // æ›´ä¸¥æ ¼çš„ç”¨æˆ·ä¿¡æ¯éªŒè¯
                    if (userInfo && userInfo.username && userInfo.username.trim() !== '') {
                        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                        const userNameElement = document.getElementById('userName');
                        const userRoleElement = document.getElementById('userRole');
                        const userAvatarElement = document.getElementById('userAvatar');
                        
                        if (userNameElement) userNameElement.textContent = userInfo.username;
                        if (userRoleElement) userRoleElement.textContent = userInfo.role || 'æ™®é€šç”¨æˆ·';
                        if (userAvatarElement) userAvatarElement.textContent = userInfo.username.charAt(0).toUpperCase();
                        
                        if (userInfo.role === 'admin') {
                            const userManagementBtn = document.getElementById('userManagementBtn');
                            if (userManagementBtn) userManagementBtn.style.display = 'inline-block';
                        }
                        
                        if (userBar) userBar.style.display = 'flex';
                        if (loginPrompt) loginPrompt.style.display = 'none';
                    } else {
                        // æ˜¾ç¤ºè®¿å®¢æ¨¡å¼
                        if (userBar) userBar.style.display = 'none';
                        if (loginPrompt) loginPrompt.style.display = 'block';
                    }
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                    // å‡ºé”™æ—¶æ˜¾ç¤ºè®¿å®¢æ¨¡å¼
                    const userBar = document.getElementById('userBar');
                    const loginPrompt = document.getElementById('loginPrompt');
                    if (userBar) userBar.style.display = 'none';
                    if (loginPrompt) loginPrompt.style.display = 'block';
                }
            }

            initFileManager() {
                window.fileManager = {
                    files: JSON.parse(localStorage.getItem('savedFiles') || '[]'),
                    
                    searchFiles: function() {
                        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                        const filteredFiles = this.files.filter(file => 
                            (file.creator && file.creator.toLowerCase().includes(searchTerm)) ||
                            (file.buyer && file.buyer.toLowerCase().includes(searchTerm))
                        );
                        this.displayFiles(filteredFiles);
                    },
                    
                    clearSearch: function() {
                        document.getElementById('searchInput').value = '';
                        this.displayFiles(this.files);
                    },
                    
                    displayFiles: function(filesToShow = this.files) {
                        const container = document.getElementById('fileListContent');
                        const fileCount = document.getElementById('fileCount');
                        const lastSave = document.getElementById('lastSave');
                        
                        fileCount.textContent = this.files.length;
                        
                        if (this.files.length > 0) {
                            const latest = Math.max(...this.files.map(f => f.timestamp));
                            lastSave.textContent = new Date(latest).toLocaleString();
                        } else {
                            lastSave.textContent = 'ä»æœª';
                        }
                        
                        if (filesToShow.length === 0) {
                            container.innerHTML = '<div class="empty-message">æš‚æ— æ–‡ä»¶</div>';
                            return;
                        }
                        
                        container.innerHTML = filesToShow.map(file => `
                            <div class="file-item">
                                <div class="file-header">
                                    <div class="file-creator">ğŸ‘¤ ${file.creator || 'æœªçŸ¥ç”¨æˆ·'}</div>
                                    <div class="file-title">ğŸ“„ ${file.title || 'æœªå‘½åè®¢å•'}</div>
                                </div>
                                <div class="file-meta">
                                    ğŸ“… ${new Date(file.timestamp).toLocaleString()} | 
                                    ğŸ¢ ä¹°æ–¹: ${file.buyer || 'æœªå¡«å†™'} | 
                                    ğŸ’° é‡‘é¢: Â¥${file.amount || '0.00'}
                                </div>
                                <div class="file-preview">
                                    ğŸ“ ${file.preview || 'æš‚æ— é¢„è§ˆ'}
                                </div>
                                <div class="file-actions">
                                    <button class="btn btn-load" onclick="window.fileManager.loadFile('${file.id}')">ğŸ“‚ åŠ è½½</button>
                                    <button class="btn btn-edit" onclick="window.fileManager.editFile('${file.id}')">âœï¸ ç¼–è¾‘</button>
                                    <button class="btn btn-delete" onclick="window.fileManager.deleteFile('${file.id}')">ğŸ—‘ï¸ åˆ é™¤</button>
                                </div>
                            </div>
                        `).join('');
                    },
                    
                    loadFile: function(fileId) {
                        const file = this.files.find(f => f.id === fileId);
                        if (file && file.data) {
                            window.autoSync.fillFormData(file.data);
                            toggleFileList();
                            alert('æ–‡ä»¶åŠ è½½æˆåŠŸï¼');
                        }
                    },
                    
                    editFile: function(fileId) {
                        const file = this.files.find(f => f.id === fileId);
                        if (file && file.data) {
                            // åŠ è½½æ–‡ä»¶æ•°æ®åˆ°è¡¨å•
                            window.autoSync.fillFormData(file.data);
                            
                            // å…³é—­æ–‡ä»¶åˆ—è¡¨é¢æ¿
                            toggleFileList();
                            
                            // æ˜¾ç¤ºç¼–è¾‘æç¤º
                            const orderNumber = file.title || 'æœªçŸ¥è®¢å•';
                            const editOptions = [
                                'ç»§ç»­ç¼–è¾‘å½“å‰è®¢å•',
                                'è½¬ä¸ºç»“ç®—å•æ®',
                                'å¦å­˜ä¸ºæ–°è®¢å•'
                            ];
                            
                            const choice = prompt(`æ­£åœ¨ç¼–è¾‘è®¢å•: ${orderNumber}

è¯·é€‰æ‹©æ“ä½œ:
1. ${editOptions[0]}
2. ${editOptions[1]}
3. ${editOptions[2]}

è¯·è¾“å…¥æ•°å­— 1-3:`);
                            
                            if (choice === '2') {
                                // è½¬ä¸ºç»“ç®—
                                selectDocType('ç»“ç®—');
                                alert('å·²åˆ‡æ¢ä¸ºç»“ç®—æ¨¡å¼ï¼Œè¯·ä¿®æ”¹ç›¸å…³ä¿¡æ¯åä¿å­˜');
                            } else if (choice === '3') {
                                // å¦å­˜ä¸ºæ–°è®¢å•ï¼Œç”Ÿæˆæ–°å•å·
                                const orderInput = document.getElementById('orderNumberInput');
                                if (orderInput) {
                                    orderInput.value = 'GX' + Date.now().toString().slice(-8);
                                }
                                alert('å·²ç”Ÿæˆæ–°è®¢å•å·ï¼Œè¯·ä¿®æ”¹åä¿å­˜ä¸ºæ–°è®¢å•');
                            } else {
                                // ç»§ç»­ç¼–è¾‘å½“å‰è®¢å•
                                alert('æ–‡ä»¶å·²åŠ è½½ï¼Œå¯ä»¥ç»§ç»­ç¼–è¾‘');
                            }
                        } else {
                            alert('æ— æ³•åŠ è½½æ–‡ä»¶æ•°æ®');
                        }
                    },
                    
                    deleteFile: function(fileId) {
                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')) {
                            this.files = this.files.filter(f => f.id !== fileId);
                            localStorage.setItem('savedFiles', JSON.stringify(this.files));
                            this.displayFiles();
                        }
                    },
                    
                    cleanupDuplicates: function() {
                        const seen = new Set();
                        const unique = this.files.filter(file => {
                            const key = `${file.creator}_${file.buyer}_${file.amount}`;
                            if (seen.has(key)) {
                                return false;
                            }
                            seen.add(key);
                            return true;
                        });
                        
                        const removed = this.files.length - unique.length;
                        if (removed > 0) {
                            this.files = unique;
                            localStorage.setItem('savedFiles', JSON.stringify(this.files));
                            this.displayFiles();
                            alert(`å·²æ¸…ç† ${removed} ä¸ªé‡å¤æ–‡ä»¶`);
                        } else {
                            alert('æ²¡æœ‰å‘ç°é‡å¤æ–‡ä»¶');
                        }
                    }
                };
                
                window.fileManager.displayFiles();
            }
        }

        // å…¨å±€å‡½æ•°
        function toggleDevicePanel() {
            const panel = document.getElementById('devicePanel');
            panel.classList.toggle('show');
        }

        function generateNewSyncCode() {
            window.autoSync.generateSyncCode();
        }

        function inputSyncCode() {
            window.autoSync.inputSyncCode();
        }

        function saveToCloud() {
            try {
                // å…ˆä¿å­˜åˆ°æœ¬åœ°
                const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                const formData = window.autoSync.collectFormData();
                
                // è·å–å•å·ä½œä¸ºæ ‡é¢˜
                const orderNumber = document.getElementById('orderNumberInput')?.value || 'GX' + Date.now().toString().slice(-8);
                
                // åˆ›å»ºæ–‡ä»¶è®°å½•
                const fileRecord = {
                    id: 'file_' + Date.now(),
                    title: orderNumber, // ä½¿ç”¨å•å·ä½œä¸ºæ ‡é¢˜
                    creator: userInfo.username || 'è®¿å®¢ç”¨æˆ·',
                    buyer: document.querySelector('tr:first-child td:nth-child(2) input')?.value || 'æœªå¡«å†™',
                    amount: document.getElementById('totalAmount')?.value || '0.00',
                    timestamp: Date.now(),
                    data: formData,
                    preview: `è´­è´§æ–¹: ${document.querySelector('tr:first-child td:nth-child(2) input')?.value || 'æœªå¡«å†™'} | é‡‘é¢: Â¥${document.getElementById('totalAmount')?.value || '0.00'}`
                };
                
                // ä¿å­˜åˆ°æ–‡ä»¶åˆ—è¡¨
                const savedFiles = JSON.parse(localStorage.getItem('savedFiles') || '[]');
                savedFiles.unshift(fileRecord);
                localStorage.setItem('savedFiles', JSON.stringify(savedFiles));
                
                // åŒæ­¥åˆ°äº‘ç«¯
                window.autoSync.syncToCloud();
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                if (window.fileManager) {
                    window.fileManager.files = savedFiles;
                    window.fileManager.displayFiles();
                }
                
                alert('ä¿å­˜åˆ°äº‘ç«¯æˆåŠŸï¼');
            } catch (error) {
                console.error('ä¿å­˜åˆ°äº‘ç«¯å¤±è´¥:', error);
                alert('ä¿å­˜åˆ°äº‘ç«¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        function saveAndNew() {
            try {
                // ä¿å­˜å½“å‰æ•°æ®
                const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                const formData = window.autoSync.collectFormData();
                
                // è·å–å•å·ä½œä¸ºæ ‡é¢˜
                const orderNumber = document.getElementById('orderNumberInput')?.value || 'GX' + Date.now().toString().slice(-8);
                
                // åˆ›å»ºæ–‡ä»¶è®°å½•
                const fileRecord = {
                    id: 'file_' + Date.now(),
                    title: orderNumber, // ä½¿ç”¨å•å·ä½œä¸ºæ ‡é¢˜
                    creator: userInfo.username || 'è®¿å®¢ç”¨æˆ·',
                    buyer: document.querySelector('tr:first-child td:nth-child(2) input')?.value || 'æœªå¡«å†™',
                    amount: document.getElementById('totalAmount')?.value || '0.00',
                    timestamp: Date.now(),
                    data: formData,
                    preview: `è´­è´§æ–¹: ${document.querySelector('tr:first-child td:nth-child(2) input')?.value || 'æœªå¡«å†™'} | é‡‘é¢: Â¥${document.getElementById('totalAmount')?.value || '0.00'}`
                };
                
                // ä¿å­˜åˆ°æ–‡ä»¶åˆ—è¡¨
                const savedFiles = JSON.parse(localStorage.getItem('savedFiles') || '[]');
                savedFiles.unshift(fileRecord);
                localStorage.setItem('savedFiles', JSON.stringify(savedFiles));
                
                // åŒæ­¥åˆ°äº‘ç«¯
                window.autoSync.syncToCloud();
                
                // æ¸…ç©ºè¡¨å•ä½†ä¿ç•™é¢„è®¾ä¿¡æ¯
                document.querySelectorAll('.input-field').forEach(input => {
                    // ä¿ç•™ä¾›è´§æ–¹ä¿¡æ¯å’Œå¤‡æ³¨ç­‰é¢„è®¾ä¿¡æ¯
                    if (!input.value.includes('å¦é—¨æ±‡ä»•ç¯ä¿ç§‘æŠ€æœ‰é™å…¬å¸') && 
                        !input.value.includes('0592-5772750') && 
                        !input.value.includes('å¦é—¨å¸‚æ¹–é‡ŒåŒºé’Ÿå®…çº¢æ˜Ÿç¾å‡¯é¾™E8038') &&
                        !input.value.includes('6226 1529 0065 3167') &&
                        !input.value.includes('é¥¶ç‰ç') &&
                        !input.value.includes('ä¸­å›½æ°‘ç”Ÿé“¶è¡Œ') &&
                        !input.value.includes('è´¨ä¿æœŸäº”å¹´')) {
                        input.value = '';
                    }
                });
                
                // é‡æ–°ç”Ÿæˆå•å·
                const orderInput = document.getElementById('orderNumberInput');
                if (orderInput) {
                    orderInput.value = 'GX' + Date.now().toString().slice(-8);
                }
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                if (window.fileManager) {
                    window.fileManager.files = savedFiles;
                    window.fileManager.displayFiles();
                }
                
                alert('ä¿å­˜æˆåŠŸï¼å·²åˆ›å»ºæ–°çš„ç©ºç™½è¡¨å•ã€‚');
            } catch (error) {
                console.error('ä¿å­˜å¹¶æ–°å»ºå¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function toggleFileList() {
            const panel = document.getElementById('fileListPanel');
            if (panel.classList.contains('show')) {
                panel.classList.remove('show');
            } else {
                panel.classList.add('show');
                window.fileManager.displayFiles();
            }
        }

        function openDataManager() {
            window.open('data-manager.html', '_blank');
        }

        function printForm() {
            // éšè—ä¸éœ€è¦æ‰“å°çš„å…ƒç´ 
            const elementsToHide = document.querySelectorAll('.action-buttons, .sync-status, .device-panel, .file-list-panel, .user-bar, .login-prompt');
            elementsToHide.forEach(el => el.style.display = 'none');
            
            window.print();
            
            // æ¢å¤éšè—çš„å…ƒç´ 
            setTimeout(() => {
                elementsToHide.forEach(el => el.style.display = '');
            }, 1000);
        }

        function exportToPDF() {
            alert('PDFå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function exportToImage() {
            const elementsToHide = document.querySelectorAll('.action-buttons, .sync-status, .device-panel, .file-list-panel, .user-bar, .login-prompt');
            elementsToHide.forEach(el => el.style.display = 'none');
            
            html2canvas(document.body, {
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `è´­é”€å•_${new Date().toLocaleDateString()}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                // æ¢å¤éšè—çš„å…ƒç´ 
                elementsToHide.forEach(el => el.style.display = '');
            }).catch(error => {
                console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', error);
                alert('å¯¼å‡ºå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•');
                elementsToHide.forEach(el => el.style.display = '');
            });
        }

        function toggleDocTypeDropdown() {
            const dropdown = document.getElementById('docTypeDropdown');
            dropdown.classList.toggle('show');
        }

        function selectDocType(type) {
            document.querySelector('.doc-type-text').textContent = type;
            document.getElementById('docTypeDropdown').classList.remove('show');
            
            // æ›´æ–°å•å·åç¼€
            const orderInput = document.getElementById('orderNumberInput');
            if (orderInput) {
                let orderNumber = orderInput.value;
                if (type === 'ç»“ç®—') {
                    // å¦‚æœæ˜¯ç»“ç®—ï¼Œåœ¨å•å·ååŠ "ç»“"å­—
                    if (!orderNumber.endsWith('ç»“')) {
                        orderNumber = orderNumber.replace(/ç»“$/, '') + 'ç»“';
                    }
                    // æ›´æ–°ä»˜æ¬¾æ ‡ç­¾
                    document.getElementById('paymentLabel').textContent = 'å·²ä»˜æ¬¾é‡‘é¢';
                } else {
                    // å¦‚æœæ˜¯é¢„ç®—ï¼Œç§»é™¤"ç»“"å­—
                    orderNumber = orderNumber.replace(/ç»“$/, '');
                    // æ›´æ–°ä»˜æ¬¾æ ‡ç­¾
                    document.getElementById('paymentLabel').textContent = 'æœ¬æ¬¡ä»˜æ¬¾é‡‘é¢';
                }
                orderInput.value = orderNumber;
            }
        }

        function showUserProfile() {
            alert('ä¸ªäººè®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('userInfo');
                localStorage.removeItem('github_api_token');
                location.reload();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–è‡ªåŠ¨åŒæ­¥ç³»ç»Ÿ
            window.autoSync = new AutoSyncSystem();
            
            // è®¾ç½®è¡¨å•è®¡ç®—å’Œäº§å“ä¿¡æ¯è‡ªåŠ¨å¡«å……
            document.addEventListener('input', function(e) {
                if (e.target.matches('.product-table input[type="number"]')) {
                    window.autoSync.calculateTotal();
                }
                
                // äº§å“åç§°è‡ªåŠ¨å¡«å……
                if (e.target.matches('.product-table td:first-child input')) {
                    window.autoSync.autoFillProductInfo(e.target, 'product');
                }
                
                // å‹å·è‡ªåŠ¨å¡«å……
                if (e.target.matches('.product-table td:nth-child(2) input')) {
                    window.autoSync.autoFillProductInfo(e.target, 'model');
                }
                
                // é‡‘é¢è¾“å…¥æ—¶è‡ªåŠ¨è½¬æ¢å¤§å†™å’Œè®¡ç®—ä½™é¢
                if (e.target.matches('.amount-input')) {
                    const amount = parseFloat(e.target.value) || 0;
                    const chineseInput = document.querySelector('.chinese-amount');
                    if (chineseInput && amount > 0) {
                        chineseInput.value = window.autoSync.numberToChinese(amount);
                    }
                    window.autoSync.calculateBalance();
                }
                
                if (e.target.matches('.payment-input')) {
                    const payment = parseFloat(e.target.value) || 0;
                    const chineseInput = document.querySelector('.chinese-payment');
                    if (chineseInput && payment > 0) {
                        chineseInput.value = window.autoSync.numberToChinese(payment);
                    }
                    window.autoSync.calculateBalance();
                }
            });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.document-type-wrapper')) {
                    document.getElementById('docTypeDropdown').classList.remove('show');
                }
                
                if (!e.target.closest('.device-panel') && !e.target.matches('.btn-sync')) {
                    document.getElementById('devicePanel').classList.remove('show');
                }
            });
            
            // åˆå§‹åŒ–å•å·
            const orderInput = document.getElementById('orderNumberInput');
            if (orderInput && !orderInput.value) {
                orderInput.value = 'GX' + Date.now().toString().slice(-8);
            }
            
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            window.autoSync.loadFromCloud();
        });
    </script>
    
    <!-- Bugä¿®å¤è¡¥ä¸ -->
    <script src="bug-fix-patch.js"></script>
</body>
</html>